<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<!-- generated by to_html.pl from TJSTips.xml -->
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>To use TJS more</title>
	<meta name="author" content="W.Dee" />
	<meta http-equiv="Content-Style-Type" content="text/css" />
	<meta http-equiv="Content-Script-Type" content="text/javascript" />
	<link href="browser.css" type="text/css" rel="stylesheet" title="吉里吉里関連リファレンス用標準スタイル" />
	<link href="mailto:dee@kikyou.info" rev="Made" />
	<link href="index.html" target="_top" rel="Start" title="トップページ" />
</head>
<body>
<h1><a id="id202" name="id202">TJS2 and KAG</a>
</h1><div class="para"><div>
　TJS (TJS2) is a scripting language that can be understood directly by Kirikiri and is based on JavaScript and JAVA. KAG is described in this TJS script.<br />
　TJS scripts can be written closer to the system (concrete) than the (abstract) scenarios that KAG understands, making them more difficult to handle, but offering a wider range of possibilities.<br />
<br />
　In KAG, there are several places to specify &quot;TJS expression&quot; such as exp attribute such as eval emb link if tag, cond attribute of each tag, entity (attribute of tag with &amp;) and so on.<br />
　Using the TJS formula, you can access Kirikiri, which is usually hidden behind the KAG, relatively easily.<br />
　Also, the iscript tag can execute TJS2 scripts directly. This allows you to perform advanced processing and extend the capabilities of KAG.<br />
<br />
　See TJS2's reference for the detailed syntax, and Kirikiri 2 for the function of Kirikiri.<br />
</div></div>
<h1><a id="id203" name="id203">KAG Object Structure</a>
</h1><div class="para"><div>
　The KAG itself is written in a TJS2 script, so you have direct access (good or bad) to the internal structure of the KAG.<br />
　It is better to be careful about writing values to the variables of objects managed by KAG, but you can also refer to the variables inside KAG and apply it to more advanced scenario description.<br />
<br />
<dl>
<dt><a id="id204" name="id204" class="targanchor"><dfn>KAGWindow class</dfn></a> object</dt>
<dd>　The KAGWindow class (described in MainWindow.tjs) is a class for managing windows in KAG. Objects of this class can be accessed as global variable <code class="inlinecode"><a id="id205" name="id205" class="targanchor"><dfn>kag</dfn></a></code>.<br />
　For example, to access the variable <code class="inlinecode">skipMode</code> of the KAGWindow class (the variable that contains the current skip mode) <code class="inlinecode"><a id="id206" name="id206" class="targanchor"><dfn>kag.skipMode</dfn></a></code>.</dd>
<dt><a id="id207" name="id207" class="targanchor"><dfn>Background layer</dfn></a></dt>
<dd>　The background layer is an object of the <a id="id208" name="id208" class="targanchor"><dfn>BaseLayer class</dfn></a> (described in GraphicLayer.tjs).<br />
　The front screen background layer is accessed using <code class="inlinecode"><a id="id209" name="id209" class="targanchor"><dfn>kag.fore.base</dfn></a></code>, and the back screen background layer is accessed using <code class="inlinecode"><a id="id210" name="id210" class="targanchor"><dfn>kag.back.base</dfn></a></code>.</dd>
<dt><a id="id211" name="id211" class="targanchor"><dfn>Foreground layer</dfn></a></dt>
<dd>　The foreground layer is an object of the <a id="id212" name="id212" class="targanchor"><dfn>CharacterLayer class</dfn></a> (described in GraphicLayer.tjs).<br />
　<code class="inlinecode"><a id="id213" name="id213" class="targanchor"><dfn>kag.fore.layers</dfn></a>[n]</code> for the foreground layer on the front screen and <code class="inlinecode"><a id="id214" name="id214" class="targanchor"><dfn>kag.back.layers</dfn></a>[n]</code> for the foreground layer on the back screen (where n is the foreground layer number 0 to).</dd>
<dt><a id="id215" name="id215" class="targanchor"><dfn>Message layer</dfn></a></dt>
<dd>　The message layer is an object of <a id="id216" name="id216" class="targanchor"><dfn>MessageLayer class</dfn></a> (described in MessageLayer.tjs).<br />
　The message layer on the front screen is <code class="inlinecode"><a id="id217" name="id217" class="targanchor"><dfn>kag.fore.messages</dfn></a>[n]</code>, and the message layer on the back screen is <code class="inlinecode"><a id="id218" name="id218" class="targanchor"><dfn>kag.back.messages</dfn></a>[n]</code> (where n is the message layer number from 0).<br />
　<code class="inlinecode"><a id="id219" name="id219" class="targanchor"><dfn>kag.current</dfn></a></code> represents the message layer currently being operated on.</dd>
<dt><a id="id220" name="id220" class="targanchor"><dfn>Objects in the message layer</dfn></a></dt>
<dd>　Use the links in the message layer to access the graphical buttons, edits, checkboxes, etc. created in the message layer.<br />
　links is an array object that contains references to the objects that manage them, in the order in which links, graphical buttons, edits, checkboxes, etc. are created. Of these, graphical buttons, edits, and checkboxes allow direct access to objects of each class by accessing the object variable.<br />
　For example, if the message layer 0 on the front screen has the following description,<br />

<br />
<code class="bq">@cm<br />
@edit&nbsp;length=420&nbsp;name=&quot;f.name&quot;<br />
</code>
<br />

    　To set the focus on this edit (make it possible to type on the keyboard), you can further write<br />

<br />
<code class="bq">@eval&nbsp;exp=&quot;kag.fore.messages[0].links[0].object.focus()&quot;<br />
</code>
<br />

　(useful when you want to display the edit and prompt the user for input immediately).</dd>
<dt><a id="id221" name="id221" class="targanchor"><dfn>Sound effect buffer</dfn></a></dt>
<dd>　The sound effect buffer is an object of <a id="id222" name="id222" class="targanchor"><dfn>SESoundBuffer class</dfn></a> (described in SE.tjs).<br />
　You can access it with <code class="inlinecode"><a id="id223" name="id223" class="targanchor"><dfn>kag.se</dfn></a>[n]</code> (where n is the sound effect buffer number 0 to).</dd>
<dt><a id="id224" name="id224" class="targanchor"><dfn>BGM object</dfn></a></dt>
<dd>　BGM object is an object of <a id="id225" name="id225" class="targanchor"><dfn>BGM class</dfn></a> (described in BGM.tjs).<br />
　It can be accessed using <code class="inlinecode"><a id="id226" name="id226" class="targanchor"><dfn>kag.bgm</dfn></a></code>.</dd>
<dt><a id="id227" name="id227" class="targanchor"><dfn>menu</dfn></a></dt>
<dd>　Menu objects can be accessed at <code class="inlinecode"><a id="id228" name="id228" class="targanchor"><dfn>kag.menu</dfn></a></code>. <code class="inlinecode">kag.menu</code> is an object of the MenuItem class. <code class="inlinecode">kag.menu</code> itself shows the menu bar, and the items registered in its children are arranged in the menu bar.<br />
　Menu items are created in Menus.tjs, but if you directly rewrite Menus.tjs, you will have to rewrite it every time by updating the KAG system, so create AfterInit.tjs and change it there as described later It is easy to describe</dd></dl></div></div>

<h1><a id="id229" name="id229">Precautions when using TJS</a>
</h1><div class="para"><div>
　If KAG directly changes something that is not stored in the bookmark, it will not be possible to reproduce that part even if KAG reads the bookmark.<br />
　There is no problem if you hook up the KAG plug-in onStore or onRestore and save the information in the bookmark, but if you do not do so, you need to be careful.<br />
　In particular, be careful when using the drawing methods belonging to the Layer class to change the contents of the background layer and foreground layer managed by KAG. KAG keeps track of what images are loaded in a layer, but not the drawings or changes made to the layer. Therefore, in such a state, even if you pass the &quot;label that can save bookmarks&quot;, save the bookmark there, and read out the bookmark, you will not be able to reproduce the changes made to the layer.<br />
　In such a case, clear the image or read another image before passing the &quot;label that can save bookmarks&quot; next time to return to a state where KAG can be managed, or You can avoid this by not writing &quot;storable labels&quot;.<br />
　When using TJS, be very careful about the relationship with bookmarks.<br />
</div></div>
<h1><a id="id230" name="id230">Items used in calculations, condition judgments, and displays in expressions</a>
</h1><div class="para"><div>
<dl>
<dt><code class="inlinecode"><a id="id231" name="id231" class="targanchor"><dfn>&amp;&amp;</dfn></a></code> and <code class="inlinecode"><a id="id232" name="id232" class="targanchor"><dfn>||</dfn></a></code></dt>
<dd>　The two are operators, where <code class="inlinecode">&amp;&amp;</code> represents &quot;and&quot; and <code class="inlinecode">||</code> represents &quot;or&quot;.<br />
　For example, if you want to do something on condition that <code class="inlinecode">f.flag1</code> is 1 and <code class="inlinecode">f.flag2</code> is 2,<br />
<br />
<code class="inlinecode">[if exp=&quot;f.flag1==1 &amp;&amp; f.flag2==1&quot;]</code><br />
<br />
　You can write.<br />
　Also, if f.flag1 is 1 or 2 or 3,<br />
<br />
<code class="inlinecode">[if exp=&quot;f.flag1==1 || f.flag1==2 || f.flag1==3&quot;]</code><br />
<br />
　(If f.flag1 is an integer, you can also write <code class="inlinecode">f.flag1&gt;=1 &amp;&amp; f.flag1&lt;=3</code>).<br />
　<code class="inlinecode">&amp;&amp;</code> and <code class="inlinecode">||</code> have different precedence so that <code class="inlinecode">&amp;&amp;</code> takes precedence so that the calculation must be done with the precedence of addition over addition in ordinary formulas.<br />
　So, for example, if <code class="inlinecode">f.flag1</code> is 1 and <code class="inlinecode">f.flag2</code> is 3 or 5,<br />
<br />
<code class="inlinecode">[if exp=&quot;f.flag1==1 &amp;&amp; (f.flag2==3 || f.flag2==5)&quot;]</code><br />
<br />
　must be enclosed in ( ) parentheses.</dd>
<dt><code class="inlinecode"><a id="id233" name="id233" class="targanchor"><dfn>random</dfn></a></code> and <code class="inlinecode"><a id="id234" name="id234" class="targanchor"><dfn>intrandom</dfn></a></code></dt>
<dd>　random is a real random number between 0 and 1 inclusive.<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />@eval&nbsp;exp=&quot;f.ransuu&nbsp;=&nbsp;random&quot;</code>
<br />

<br />
　In the above example, f.ransuu contains a real random number between 0 and 1 inclusive.<br />
<br />
　In contrast, intrandom is a function that returns an integer random number between a specified value and a specified value.<br />
<br />
Format: <code class="inlinecode">intrandom(<em>minimum value</em>, <em>maximum value</em>)</code><br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />@eval&nbsp;exp=&quot;f.ransuu&nbsp;=&nbsp;intrandom(0,&nbsp;5)&quot;</code>
<br />

<br />
　In the above example, f.ransuu contains a random number between 0 and 5 inclusive.</dd>
<dt><code class="inlinecode"><a id="id235" name="id235" class="targanchor"><dfn>length</dfn></a></code></dt>
<dd>　length is the length of the string. To use it, write a . (dot) after the variable to which the string is assigned, followed by length.<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />[if&nbsp;exp=&quot;f.namae.length&gt;=8&quot;]Name&nbsp;is&nbsp;too&nbsp;long.[l][jump&nbsp;target=*input][endif]</code>
<br />

<br />
　In the above example, if the length of f.namae is more than 8 characters, &quot;Name is too long.&quot; is displayed and jump to *input label.<br />
　Characters are counted as one character, regardless of whether they are half-width or full-width. This is the same for functions that handle other strings.</dd>
<dt><code class="inlinecode"><a id="id236" name="id236" class="targanchor"><dfn>substring</dfn></a></code></dt>
<dd>　substring can extract a part of a string (substring).<br />
　To use it, write a . (dot) after the variable (or the one that represents the string) to which the string is assigned, and then<br />
<br />
<code class="inlinecode">substring(<em>cut start position</em>, <em>cut length</em>)</code><br />
<br />
　Write in the format of 0 indicates the beginning of the cutting start position.<br />
<br />
　For example, if you want to retrieve the second character of the f.furigana variable, you can retrieve it with <code class="inlinecode">f.furigana.substring(1, 1)</code>.<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />@emb&nbsp;exp=&quot;f.furigana.substring(1,&nbsp;1)&quot;</code>
<br />

<br />
　In the above example, the second character of the f.furigana variable is displayed.</dd>
<dt><code class="inlinecode"><a id="id237" name="id237" class="targanchor"><dfn>indexOf</dfn></a></code></dt>
<dd>　indexOf gives the position of the first occurrence of a substring in a string. In other words, you can check whether a string contains another string.<br />
<br />
Format: <code class="inlinecode"><em>string</em>.indexOf(<em>substring</em>)</code><br />
<br />
　For example, if the string was <code class="inlinecode">&quot;ABCDEFGHIJKL&quot;</code> and the substring was <code class="inlinecode">&quot;ABC&quot;</code>, the <code class="inlinecode">&quot;ABCDEFGHIJKL&quot;.indexOf(&quot;ABC&quot;)</code> would be <em>0</em>. If the substring is <code class="inlinecode">&quot;BCD&quot;</code>, it is <em>1</em>, and if it is <code class="inlinecode">&quot;DEF&quot;</code>, it is <em>3</em>.
　If the substring does not appear in the string, it will be <em>-1</em>, so to determine whether the substring is part of the string, use -1 and You just have to compare.<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />[if&nbsp;exp=&quot;'bitchfartass'.indexOf(f.objname)!=-1&quot;]~~[endif]</code>
<br />

<br />
　In the above example, <code class="inlinecode">f.objname</code> is one of <code class="inlinecode">&quot;bitch&quot; &quot;fart&quot; &quot;ass&quot; &quot;bitchfart&quot; &quot;fartass&quot; &quot;bitchfartass&quot;</code> In this case, execute up to <code class="inlinecode">endif</code>.<br />
　If you want to set this as NG in <code class="inlinecode">&quot;bitch&quot;, &quot;fart&quot;, &quot;ass&quot;</code> (OK only for <code class="inlinecode">&quot;bitch&quot; &quot;fart&quot; &quot;ass&quot;</code>) If you want to do this, you can achieve this by separating each of the <code class="inlinecode">'nofia'</code> with characters (or symbols) that do not appear in <code class="inlinecode">f.objname</code>.<br />
　For example, using the special control symbol \v to separate<br />
<br />
<code class="inlinecode">[if exp=&quot;'bitch\vfart\vass'.indexOf(f.objname)!=-1&quot;]~~[endif]</code><br />
You can do that (since \v doesn't usually appear in f.objname).<br />
<br />
　In the example below, if the character string 'cup' is included in f.itemname, the process is executed up to endif.<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />[if&nbsp;exp=&quot;f.itemname.indexOf('cup')!=-1&quot;]~~[endif]</code>
<br />

</dd>
<dt><a id="id238" name="id238" class="targanchor"><dfn>Regular expression</dfn></a></dt>
<dd>　You can use regular expression patterns (parts enclosed by / and /) to decompose and inspect strings using regular expression patterns.<br />
　The regular expression pattern itself is very similar to Perl's regular expressions (they are different, but the regular expression patterns are almost compatible).<br />
<br />
　Use <code class="inlinecode"><a id="id239" name="id239" class="targanchor"><dfn>test</dfn></a></code> to check if a string matches the desired pattern.<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />[if&nbsp;exp=&quot;/[^0-9]/.test(f.nyuryoku)&quot;]The&nbsp;entered&nbsp;characters&nbsp;are&nbsp;not&nbsp;numbers[endif]</code>
<br />

<br />
　Use test as in the example above. test is a function (a method of a regular expression object) that returns true if it matches the pattern and false if it doesn't. In the above example, <code class="inlinecode">[^0-9]</code>, that is, using a regular expression pattern to check for non-numeric characters, use <code class="inlinecode">f.nyuryoku</code> to check for mixed characters.<br />
<br />
　Use <code class="inlinecode"><a id="id240" name="id240" class="targanchor"><dfn>match</dfn></a></code> to decompose a string. <code class="inlinecode">match</code> returns an array object. If the pattern does not match, the number of elements in the array (<code class="inlinecode">count</code>) will be 0. Otherwise, element 0 returns the entire match, element 1 and the rest of the pattern corresponding to ( ) (parentheses) in the pattern.<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />[eval&nbsp;exp=&quot;f.matched&nbsp;=&nbsp;/([0-9０-９]+)[-−]([0-9０-９]+)/.match(f.input)&quot;]<br />
[if&nbsp;exp=&quot;f.matched.count&nbsp;==&nbsp;0&quot;]Please&nbsp;enter&nbsp;in&nbsp;the&nbsp;format&nbsp;&quot;number-number&quot;.[jump&nbsp;target=*input][endif]<br />
[eval&nbsp;exp=&quot;f.s1&nbsp;=&nbsp;str2num(f.matched[1]),&nbsp;f.s2&nbsp;=&nbsp;str2num(f.matched[2])&quot;]<br />
</code>
<br />

　In the above example, <code class="inlinecode">f.input</code> tests whether it conforms to the format &quot;number-number&quot;, and if it does, the  in front of the-(hyphen) <code class="inlinecode">f.s1</code> is converted to a numerical value, and the rest is converted to a numerical value in <code class="inlinecode">f.s2</code>.</dd>
<dt><code class="inlinecode"><a id="id241" name="id241" class="targanchor"><dfn>str2num</dfn></a></code></dt>
<dd>　str2num converts a string to a number.<br />
<br />
Format: <code class="inlinecode">str2num(<em>String or variable containing string</em>)</code><br />
<br />
　Unlike the unary <code class="inlinecode">+</code> operator, <code class="inlinecode">str2num</code> can be converted to a number even if it is a full-width number. I think it can be used when there is a possibility that the user will enter a numerical value in full width like an input tag. If a string that is not recognized as a number is passed, it will be 0.<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />[input&nbsp;name=&quot;f.kazu&quot;&nbsp;prompt=&quot;Please&nbsp;enter&nbsp;a&nbsp;number&quot;][emb&nbsp;exp=&quot;f.kazu=str2num(f.kazu)&quot;]</code>
<br />

</dd>

<dt><code class="inlinecode"><a id="id242" name="id242" class="targanchor"><dfn>kansuuji</dfn></a></code> and <code class="inlinecode"><a id="id243" name="id243" class="targanchor"><dfn>kansuuji_simple</dfn></a></code></dt>
<dd>　<code class="inlinecode">kansuuji</code> converts the specified number to kanji numeric notation. The same applies to <code class="inlinecode">kansuuji_simple</code>, but without a unit to represent the digits.<br />
　Converts the number 9223372036854775807 to &quot;九百二十二京三千三百七十二兆三百六十八億五千四百七十七万五千八百七&quot; for <code class="inlinecode">kansuuji</code> and &quot;九二二三三七二〇三六八五四七七五八〇七&quot; for <code class="inlinecode">kansuuji_simple</code>.<br />

<br />
<code class="bq"><span class="weak">例:</span><br />@emb&nbsp;exp=&quot;kansuuji(f.num)&quot;<br />
</code>
<br />

　In the above example, f.num is displayed in Chinese numeral notation.<br />
</dd>
<dt><code class="inlinecode"><a id="id244" name="id244" class="targanchor"><dfn>number_format</dfn></a></code></dt>
<dd>　<code class="inlinecode">number_format</code> indicates the specified number in three digits separated by, (comma). For example, the number 9223372036854775807 is converted to &quot;9,223,372,036,854,775,807&quot;.<br />

<br />
<code class="bq"><span class="weak">例:</span><br />@emb&nbsp;exp=&quot;number_format(f.num)&quot;<br />
</code>
<br />

　In the above example, f.num is displayed every three digits, separated by commas.<br />
</dd>

<dt><code class="inlinecode"><a id="id245" name="id245" class="targanchor"><dfn>Storages.addAutoPath</dfn></a> and <a id="id246" name="id246" class="targanchor"><dfn>System.exePath</dfn></a></code></dt>
<dd>　Storages.addAutoPath adds an automatic search path.<br />
　System.exePath indicates the folder where the Kirikiri executable file is located.<br />
　For more information, please refer to the Kirikiri SDK Help, which allows you to set automatic search paths for archives and folders.<br />
　The automatic search path is a mechanism for automatically finding files without having to specify a folder. By default, all of system image scenario bgimage fgimage bgm sound rule others video are set, but can be added by Storages.addAutoPath.<br />
System.exePath is the folder where the Kirikiri executable file is located.<br />
<br />
　For example, if there is a folder called cgdata directly under the Kirikiri executable file and you want to specify that as the automatic search path,<br />
<br />
<code class="inlinecode">[eval exp=&quot;Storages.addAutoPath(System.exePath + 'cgdata/')&quot;]</code><br />
<br />
　(Be sure to put the / after cgdata).<br />
<br />
　If you have an archive file cgdata.xp3 in the same location as the Kirikiri executable file, and you want to specify an automatic search path in this archive,<br />
<br />
<code class="inlinecode">[eval exp=&quot;Storages.addAutoPath(System.exePath + 'cgdata.xp3&gt;')&quot;]</code><br />
<br />
　will do. The symbol after cgdata.xp3 is &gt;. Use &gt; to specify a search path within the archive, or / to specify a search path within a folder.<br />
　The symbol after the archive was changed from '#' to '&gt;' in Kirikiri 2 2.19 beta 14.<br />
</dd>
<dt><code class="inlinecode"><a id="id247" name="id247" class="targanchor"><dfn>Storages.searchCD</dfn></a></code></dt>
<dd>　Storages.searchCD returns the letter of the drive where the CD with the volume label passed in the argument is inserted.<br />
　For example, if you want to add an automatic search path to the folder named image on the CD-ROM with the volume label FOO_BAR_DISC in combination with Storages.addAutoPath above,<br />
<br />
<code class="inlinecode">[eval exp=&quot;Storages.addAutoPath(Storages.searchCD('FOO_BAR_DISC') + ':image/')&quot;]</code><br />
<br />
　Can be written as<br />
<br />
　Stotages.searchCD returns an empty string if it cannot find a drive with a CD with the specified volume label, so to make sure, for example, that the specified CD-ROM is in the drive,<br />
<br />
<code class="inlinecode">[if exp=&quot;Storages.searchCD('FOO_BAR_DISC') == ''&quot;]No CD inserted[endif]</code><br />
<br />
　Can be written as</dd>
<dt><code class="inlinecode"><a id="id248" name="id248" class="targanchor"><dfn>System.readRegValue</dfn></a></code></dt>
<dd>　System.readRegValue allows you to read the value written to the registry. For example, to load HKEY_LOCAL_MACHINE\SOFTWARE\Dee\kirikiri\installpath into f.installpath,<br />
<br />
<code class="inlinecode">[eval exp=&quot;f.installpath = System.readRegValue('HKEY_LOCAL_MACHINE\\SOFTWARE\\Dee\\kirikiri\\installpath')&quot;]</code><br />
　will do. Note that \ must be written as \\ in ''.<br />
　Only string and numeric values can be read. If there is no value in the registry, it will be void, so use <code class="inlinecode">===</code> (identification operator)<br />
<br />
<code class="inlinecode">[if exp=&quot;f.installpath === void&quot;]Not installed[endif]</code><br />
<br />
　You can write something like</dd>
<dt><code class="inlinecode"><a id="id249" name="id249" class="targanchor"><dfn>kag.clickCount</dfn></a></code></dt>
<dd>　Each time the mouse is clicked on the screen, 1 is added. You can assign a value to this variable, so if you set it to 0, you can know that the mouse has been clicked by checking that this variable is a non-zero number.</dd>
<dt><code class="inlinecode"><a id="id250" name="id250" class="targanchor"><dfn>kag.lastMouseDownX</dfn></a> and <a id="id251" name="id251" class="targanchor"><dfn>kag.lastMouseDownY</dfn></a></code></dt>
<dd>　These represent the coordinates where the mouse was last clicked. kag.lastMouseDownX is the last clicked X coordinate, and kag.lastMouseDownY is the last clicked Y coordinate.</dd>
<dt><code class="inlinecode"><a id="id252" name="id252" class="targanchor"><dfn>kag.lastWaitTime</dfn></a></code></dt>
<dd>　When the wait tag is used with mode=until, the time that the wait tag actually wraps is set. If the time that you have already worn has passed, it will be 0, so you can determine whether the process is catching up by determining whether this variable is not 0 immediately after the wait tag.<br />
　By the way, if the wait is interrupted due to a click or the like, this variable does not indicate the exact waiting time (it indicates the time when there was no interruption).</dd>
<dt><code class="inlinecode"><a id="id253" name="id253" class="targanchor"><dfn>kag.skipMode</dfn></a></code></dt>
<dd>　Contains a value that indicates the current skip mode. 0 = no skip, 1 = up to the click waiting sign, 2 = up to the page break waiting sign, 3 = until the next stop.<br />
　For example, if you don't want to play voices or sound effects while skipping,<br />
<br />
<code class="inlinecode">@playse cond=&quot;kag.skipMode&lt;=1&quot; storage=&quot;hogehoeg.wav&quot;</code><br />
<br />
　Can be written as</dd>
<dt><code class="inlinecode"><a id="id254" name="id254" class="targanchor"><dfn>kag.autoMode</dfn></a></code></dt>
<dd>　True during the process of automatic reading, false otherwise.<br />
　For example, if you want to process voices and sound effects at the end of automatic reading,<br />
<br />
<code class="inlinecode">@ws cond=&quot;kag.autoMode&quot;</code><br />
<br />
　Can be written as</dd>
<dt><code class="inlinecode"><a id="id255" name="id255" class="targanchor"><dfn>kag.getBookMarkPageName</dfn></a></code></dt>
<dd>　<code class="inlinecode">kag.getBookMarkPageName</code> can get the name of the bookmark location indicated by the number (0-) specified in the argument in non-free save mode.<br />
　This can be used to show the bookmark on the screen instead of from the KAG menu and let the user select the bookmark to follow.<br />
　Used in combination with <code class="inlinecode">kag.restoreBookMark</code>.<br />

<br />
<code class="bq"><span class="weak">例:</span><br />[locate&nbsp;x=10&nbsp;y=100][link&nbsp;exp=&quot;kag.restoreBookMark(0)&quot;][emb&nbsp;exp=&quot;kag.getBookMarkPageName(0)&quot;][endlink]<br />
[locate&nbsp;x=10&nbsp;y=130][link&nbsp;exp=&quot;kag.restoreBookMark(1)&quot;][emb&nbsp;exp=&quot;kag.getBookMarkPageName(1)&quot;][endlink]<br />
(The&nbsp;same&nbsp;applies&nbsp;hereinafter)<br />
</code>
<br />

</dd>
<dt><code class="inlinecode"><a id="id256" name="id256" class="targanchor"><dfn>mp</dfn></a></code></dt>
<dd>　<code class="inlinecode">mp</code> represents a dictionary array in the macro where the attributes passed to the macro are recorded.<br />

<br />
<code class="bq"><span class="weak">例:</span><br />@macro&nbsp;name=fimg<br />
@image&nbsp;*<br />
@eval&nbsp;exp=&quot;sf[mp.storage]=1&quot;<br />
@endmacro<br />
</code>
<br />

　In the above example, for example, if <code class="inlinecode">@fimg layer=base page=fore storage=&quot;bg_03&quot;</code> is written, <code class="inlinecode">mp.layer</code> is <code class="inlinecode">'base'</code>, <code class="inlinecode">mp.page</code> is <code class="inlinecode">'fore'</code>, and <code class="inlinecode">'mp.storage'</code> is <code class="inlinecode">'bg_03'</code> while this macro is executed. That is, you can get the value of an attribute passed to the macro by specifying the attribute after <code class="inlinecode">mp.</code>.<br />
　If this macro is used as <code class="inlinecode">@fimg layer=base page=fore storage=&quot;bg_03&quot;</code>, the <code class="inlinecode">sf['bg_03']</code> will be 1 because the <code class="inlinecode">sf[mp.storage]=1</code> is executed on the exp tag.<br />
　By using this macro instead of the image / img tag, it can be used as a macro that automatically records the displayed image in a system variable.</dd>
<dt><code class="inlinecode"><a id="id257" name="id257" class="targanchor"><dfn>System.getKeyState</dfn></a></code></dt>
<dd>　<code class="inlinecode">System.getKeyState</code> can determine if the specified key is currently pressed at that time.<br />

<br />
<code class="bq"><span class="weak">例:</span><br />@jump&nbsp;target=*shift_key_pressed&nbsp;cond=&quot;System.getKeyState(VK_SHIFT)&quot;<br />
;&nbsp;Jump&nbsp;to&nbsp;*shift_key_pressed&nbsp;if&nbsp;shift&nbsp;key&nbsp;is&nbsp;pressed<br />
</code>
<br />

For details, please refer to Kirikiri 2 SDK Help.<br />
<br />
　KAG3 accepts input from the gamepad (joystick), but if there is something on the gamepad or if the joystick axis is not properly adjusted, you may not be able to operate the work properly.<br />
　A warning can be given to the user if the gamepad button is pressed at the start of the work (usually the gamepad button is not pressed at the start of the work, but should be pressed If it is, it is likely that it has been pressed for a reason not intended by the user.)<br />
　In the following example, it may not be possible to detect &quot;pressed&quot; on a USB-connected game pad, so we recommend supplementing it with documentation as appropriate.<br />

<br />
<code class="bq"><span class="weak">例:</span><br />@if&nbsp;exp=&quot;System.getKeyState(VK_PADANY)&quot;<br />
@wait&nbsp;time=500<br />
@if&nbsp;exp=&quot;System.getKeyState(VK_PADANY)&quot;<br />
;&nbsp;VK_PADANY&nbsp;returns&nbsp;true&nbsp;when&nbsp;any&nbsp;button&nbsp;on&nbsp;the&nbsp;gamepad&nbsp;is&nbsp;pressed<br />
;&nbsp;Display&nbsp;a&nbsp;message&nbsp;if&nbsp;it&nbsp;is&nbsp;still&nbsp;pressed&nbsp;after&nbsp;500ms&nbsp;(0.5&nbsp;seconds)<br />
The&nbsp;button&nbsp;on&nbsp;the&nbsp;gamepad&nbsp;(joystick)&nbsp;is&nbsp;being&nbsp;pressed.<br />
Check&nbsp;that&nbsp;nothing&nbsp;is&nbsp;on&nbsp;the&nbsp;gamepad&nbsp;or&nbsp;that&nbsp;the&nbsp;joystick&nbsp;axis&nbsp;is&nbsp;adjusted.<br />
If&nbsp;the&nbsp;situation&nbsp;does&nbsp;not&nbsp;improve,&nbsp;remove&nbsp;the&nbsp;gamepad&nbsp;(joystick).<br />
If&nbsp;the&nbsp;situation&nbsp;still&nbsp;does&nbsp;not&nbsp;improve,&nbsp;quit&nbsp;the&nbsp;game,&nbsp;start&nbsp;&quot;Engine&nbsp;Settings&quot;,&nbsp;and&nbsp;set&nbsp;&quot;Input-Pad&nbsp;Availability&quot;&nbsp;to&nbsp;&quot;Not&nbsp;Use&quot;.<br />
[s]<br />
@endif<br />
@endif<br />
</code>
<br />

</dd>

</dl>

</div></div>
<h1><a id="id258" name="id258">What is specified in the exp attribute of the link or button</a>
</h1><div class="para"><div>
<dl>
<dt><code class="inlinecode"><a id="id259" name="id259" class="targanchor"><dfn>System.shellExecute</dfn></a></code></dt>
<dd>　System.shellExecute opens the file specified in the argument. When you specify the URL, the browser opens, so if you execute this formula using a link tag, you can create a link to a web page.<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />[link&nbsp;exp=&quot;System.shellExecute('http://www.yahoo.co.jp/')&quot;]http://www.yahoo.co.jp/[endlink]</code>
<br />

</dd>
<dt><code class="inlinecode"><a id="id260" name="id260" class="targanchor"><dfn>kag.close</dfn></a></code> and <code class="inlinecode"><a id="id261" name="id261" class="targanchor"><dfn>kag.shutdown</dfn></a></code></dt>
<dd>　kag.close terminates KAG. If you have set to confirm the end, there is an end confirmation.<br />
　kag.shutdown also terminates KAG, but there is no confirmation.<br />
　If you use System.exit() to exit, <em>do not use it</em> because system variables may be exited without saving. Also, do not specify them in the exp attribute of the eval tag (use the close tag instead).<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />[link&nbsp;exp=&quot;kag.close()&quot;]Close[endlink]<br />
[link&nbsp;exp=&quot;kag.shutdown()&quot;]Close[endlink]<br />
</code>
<br />

</dd>
<dt><code class="inlinecode"><a id="id262" name="id262" class="targanchor"><dfn>kag.restoreBookMark</dfn></a></code> and <code class="inlinecode"><a id="id263" name="id263" class="targanchor"><dfn>kag.storeBookMark</dfn></a></code></dt>
<dd>　kag.restoreBookMark follows the bookmark indicated by the number specified in the argument in non-free save mode.<br />
　Similarly, kag.storeBookMark sandwiches the bookmark indicated by the number specified in the argument.<br />
　However, if this is called directly, the bookmark can be operated even if the use of the bookmark is prohibited by the [store] tag.<br />
　These return true on success and false on failure.<br />
　See kag.getBookMarkPageName for an example.</dd>
<dt><code class="inlinecode"><a id="id264" name="id264" class="targanchor"><dfn>kag.loadBookMarkFromFileWithAsk</dfn></a></code> and <code class="inlinecode"><a id="id265" name="id265" class="targanchor"><dfn>kag.saveBookMarkToFileWithAsk</dfn></a></code></dt>
<dd>　kag.loadBookMarkFromFileWithAsk displays a file selection dialog box in free save mode and allows the user to select bookmark data. When the user presses the OK button, it resumes from that bookmark.<br />
　Similarly, kag.saveBookMarkToFileWithAsk displays a file selection dialog box and saves the bookmark.<br />
　These return true on success and false if the user cancels or fails.<br />

<br />
<code class="bq"><span class="weak">例:</span><br />[link&nbsp;exp=&quot;kag.loadBookMarkFromFileWithAsk()&quot;]Follow&nbsp;the&nbsp;bookmark[endlink]<br />
[link&nbsp;exp=&quot;kag.saveBookMarkToFileWithAsk()&quot;]Insert&nbsp;a&nbsp;bookmark[endlink]<br />
</code>
<br />

</dd>
<dt><code class="inlinecode"><a id="id266" name="id266" class="targanchor"><dfn>kag.callExtraConductor</dfn></a></code></dt>
<dd>　kag.callExtraConductor is used to call a KAG scenario as a subroutine under the control of TJS. When calling a scenario with this method, the scenario must be stopped by a click wait or s tag (you can know by kag.inStable or onStableStateChanged of the KAG plugin).<br />
　kag.callExtraConductor has three arguments.<br />
　The first argument is the scenario file to call. The next argument is the label to call.<br />
　The third argument is optional, but specifies the function / method to execute when returning from the KAG scenario. If you do not need it, you do not need to specify it.<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />[button&nbsp;graphic=&quot;showhist&quot;&nbsp;exp=&quot;kag.callExtraConductor('rclick.ks',&nbsp;'*showhist')&quot;]</code>
<br />

<br />
　The method of writing the subroutine to be called in this way conforms to the method of writing the right-click subroutine.<br />
　This function cannot be used during a right-click subroutine or while already using this function to call a KAG scenario.</dd>
<dt><code class="inlinecode"><a id="id267" name="id267" class="targanchor"><dfn>kag.se[n].play</dfn></a></code></dt>
<dd>　The sound effect buffer's play method starts playing the sound effect.<br />
　Specify in the following format.<br />
<br />
　
<br />
<code class="bq">kag.se[Sound&nbsp;effect&nbsp;buffer&nbsp;number].play(%[storage:&nbsp;File&nbsp;name&nbsp;of&nbsp;sound&nbsp;effect&nbsp;to&nbsp;play,&nbsp;loop:&nbsp;Loop]);</code>
<br />

<br />
　For example, if you specify this in the onenter attribute of the link tag as in the following example, you can play a sound effect when the mouse cursor hovers over the choice.<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />[link&nbsp;target=*foo&nbsp;onenter=&quot;kag.se[0].play(%[storage:'select.wav',&nbsp;loop:&nbsp;false])&quot;]Choices&nbsp;~[endlink]</code>
<br />

<br />
　In this example, select.wav is played without loop in sound effect buffer 0. This is also useful when you want to play sound effects under the control of TJS.</dd></dl></div></div>
<h1><a id="id268" name="id268">Array</a>
</h1><div class="para"><div>
　In Kirikiri 2 / KAG3, arrays can be used easily.<br />
　If you use an array, you must first declare the array using <code class="inlinecode"><a id="id269" name="id269" class="targanchor"><dfn>[ ]</dfn></a></code>.<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />[eval&nbsp;exp=&quot;f.hairetsu&nbsp;=&nbsp;[]&quot;]</code>
<br />

<br />
　In the above example, we declare that <code class="inlinecode">f.hairetsu</code> is used as an array. Note that if <code class="inlinecode">f.hairetsu</code> is already an array or any other number or string, the contents of <code class="inlinecode">f.hairetsu</code> will be erased.<br />
　If you want to use an array as a system variable, take advantage of the fact that initially all variables are assumed to be assigned void,<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />[eval&nbsp;exp=&quot;sf.hairetsu&nbsp;=&nbsp;[]&nbsp;if&nbsp;sf.hairetsu&nbsp;===&nbsp;void&quot;]</code>
<br />

<br />
　, you can declare an array only at the first startup. The sequence will not be deleted even after the second time.<br />
<br />
　Use <code class="inlinecode">[ ]</code> to assign values to an array. Write a subscript (element number) in <code class="inlinecode">[ ]</code>. Subscripts start at 0.<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />[eval&nbsp;exp=&quot;f.hairetsu[0]&nbsp;=&nbsp;'zero',&nbsp;f.hairetsu[1]&nbsp;=&nbsp;'one'&quot;]</code>
<br />

<br />
　In the above example, 'zero' is assigned to <code class="inlinecode">f.hairetsu[0]</code> and 'one' is assigned to <code class="inlinecode">f.hairetsu[1]</code>.<br />
　You do not need to declare the number of elements in the array. It will automatically expand to the required size. To get or set the number of elements in the array, use the <code class="inlinecode"><a id="id270" name="id270" class="targanchor"><dfn>count</dfn></a></code> property, such as <code class="inlinecode">f.hairetsu.count</code>.<br />
<br />
　The display can be performed in the same way.<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />0&nbsp;:&nbsp;[emb&nbsp;exp=&quot;f.hairetsu[0]&quot;]&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;:&nbsp;[emb&nbsp;exp=&quot;f.hairetsu[1]&quot;]</code>
<br />

<br />
　It is a little difficult to use a two-dimensional array, but I will just give an example.<br />

<br />
<code class="bq">@iscript<br />
<span class="comment">//&nbsp;Create&nbsp;a&nbsp;two-dimensional&nbsp;array&nbsp;with&nbsp;5&nbsp;elements&nbsp;in&nbsp;the&nbsp;first&nbsp;dimension</span><br />
f.twodim&nbsp;=&nbsp;[]&nbsp;if&nbsp;f.twodim&nbsp;===&nbsp;void;&nbsp;<span class="comment">//&nbsp;Create&nbsp;first&nbsp;dimension&nbsp;array&nbsp;in&nbsp;twodim</span><br />
for(var&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;5;&nbsp;i++)&nbsp;f.twodim[i]&nbsp;=&nbsp;[]&nbsp;if&nbsp;f.twodim[i]&nbsp;===&nbsp;void;<br />
<span class="comment">//&nbsp;In&nbsp;this&nbsp;state,&nbsp;f.twodim[0]&nbsp;to&nbsp;f.twodim[4]&nbsp;are&nbsp;arrays,&nbsp;respectively.</span><br />
<span class="comment">//&nbsp;Can&nbsp;be&nbsp;specified&nbsp;as&nbsp;f.twodim[0][3]&nbsp;or&nbsp;f.twodim&nbsp;[4][2]</span><br />
@endscript<br />
<br />
<span class="comment">//&nbsp;Or,&nbsp;for&nbsp;example,&nbsp;to&nbsp;create&nbsp;an&nbsp;array&nbsp;with&nbsp;5&nbsp;elements&nbsp;in&nbsp;the&nbsp;first&nbsp;dimension</span><br />
f.twodim&nbsp;=&nbsp;[&nbsp;[],&nbsp;[],&nbsp;[],&nbsp;[],&nbsp;[]&nbsp;];<br />
<span class="comment">//&nbsp;(When&nbsp;creating&nbsp;an&nbsp;array&nbsp;with&nbsp;[],&nbsp;you&nbsp;can&nbsp;specify&nbsp;initial&nbsp;elements&nbsp;in&nbsp;it&nbsp;by&nbsp;separating&nbsp;them&nbsp;with&nbsp;commas,&nbsp;but&nbsp;at&nbsp;that&nbsp;time,&nbsp;nest&nbsp;the&nbsp;array&nbsp;as&nbsp;the&nbsp;initial&nbsp;element)</span><br />
</code>
<br />

</div></div>
<h1><a id="id271" name="id271">Dictionary array</a>
</h1><div class="para"><div>
　Kirikiri 2 / KAG3 can also use dictionary arrays.<br />
　A dictionary array (also called an associative array) is an array that can remember pairs of names and their corresponding values.<br />
　If you use a dictionary array, you must first declare the array using <code class="inlinecode"><a id="id272" name="id272" class="targanchor"><dfn>%[ ]</dfn></a></code>, just like arrays.<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />[eval&nbsp;exp=&quot;f.dict&nbsp;=&nbsp;%[]&quot;]</code>
<br />

<br />
　The above example declares that f.dict will be used as a dictionary array. If f.hairetsu is already a dictionary array, the precautions are the same as for arrays.<br />
<br />
　Also use <code class="inlinecode">[ ]</code> to assign values to the dictionary array (not <code class="inlinecode">%[ ]</code>). In <code class="inlinecode">[ ]</code>, write the &quot;name&quot;.<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />[eval&nbsp;exp=&quot;f.dict['zero']&nbsp;=&nbsp;0,&nbsp;f.dict['one']&nbsp;=&nbsp;1&quot;]</code>
<br />

<br />
　In the above example, <code class="inlinecode">0</code> is assigned to <code class="inlinecode">f.dict['zero']</code> and <code class="inlinecode">1</code> is assigned to <code class="inlinecode">f.dict['one']</code>. The difference from a normal array is that a string is specified in <code class="inlinecode">[ ]</code>.<br />
<br />
　The display can be performed in the same way.<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />zero&nbsp;:&nbsp;[emb&nbsp;exp=&quot;f.dict['zero']&quot;]&nbsp;&nbsp;&nbsp;&nbsp;one&nbsp;:&nbsp;[emb&nbsp;exp=&quot;f.dict['one']&quot;]</code>
<br />

<br />
　By the way, you can use <code class="inlinecode">.</code> instead of <code class="inlinecode">[ ]</code>. <code class="inlinecode">f.dict['zero']</code> can be described as <code class="inlinecode">f.dict.zero</code>, and <code class="inlinecode">f.dict['one']</code> as <code class="inlinecode">f.dict.one</code> (but . cannot be followed by &quot;reserved words&quot; or &quot;names that cannot be used as variable names&quot;).<br />
<br />
　In fact, KAG's <code class="inlinecode">f</code> and <code class="inlinecode">sf</code> themselves are also dictionary arrays, and if <code class="inlinecode">f.dict</code> is used, it would have accessed the value named <code class="inlinecode">'dict'</code> in the dictionary array (of course, <code class="inlinecode">f['dict']</code> can also access it).<br />
</div></div>

<h1><a id="id273" name="id273">Get date / time</a>
</h1><div class="para"><div>
　To get the current date and time:<br />

<br />
<code class="bq">[iscript]<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;↑&nbsp;Surrounding&nbsp;the&nbsp;endscript&nbsp;with&nbsp;{&nbsp;}&nbsp;is&nbsp;to&nbsp;make&nbsp;the&nbsp;variable&nbsp;declared&nbsp;in&nbsp;this&nbsp;local&nbsp;variable&nbsp;(otherwise&nbsp;it&nbsp;will&nbsp;be&nbsp;a&nbsp;global&nbsp;variable)</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;d&nbsp;=&nbsp;new&nbsp;Date();&nbsp;<span class="comment">//&nbsp;Create&nbsp;Date&nbsp;class&nbsp;object</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;Date&nbsp;class&nbsp;object&nbsp;retains&nbsp;the&nbsp;current&nbsp;time&nbsp;at&nbsp;the&nbsp;time&nbsp;of&nbsp;creation&nbsp;if&nbsp;nothing&nbsp;is&nbsp;specified&nbsp;in&nbsp;the&nbsp;argument&nbsp;at&nbsp;the&nbsp;time&nbsp;of&nbsp;creation</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;f.year&nbsp;=&nbsp;d.getYear();&nbsp;&nbsp;<span class="comment">//&nbsp;f.year&nbsp;to&nbsp;year</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;f.month&nbsp;=&nbsp;d.getMonth()&nbsp;+&nbsp;1;&nbsp;<span class="comment">//&nbsp;f.month&nbsp;to&nbsp;month</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;f.date&nbsp;=&nbsp;d.getDate();&nbsp;<span class="comment">//&nbsp;f.date&nbsp;to&nbsp;day</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;f.hours&nbsp;=&nbsp;d.getHours();&nbsp;<span class="comment">//&nbsp;f.hours&nbsp;to&nbsp;hour</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;f.minutes&nbsp;=&nbsp;d.getMinutes();&nbsp;<span class="comment">//&nbsp;f.minutes&nbsp;to&nbsp;minutes</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;f.seconds&nbsp;=&nbsp;d.getSeconds();&nbsp;<span class="comment">//&nbsp;f.seconds&nbsp;to&nbsp;seconds</span><br />
}<br />
[endscript]<br />
</code>
<br />

</div></div>
<h1><a id="id274" name="id274">process</a>
</h1><div class="para"><div>
　<code class="inlinecode">kag.process</code> runs the scenario from the specified location.<br />
　The first argument is the name of the scenario file to load. If you specify an empty string, the current scenario file will be used.<br />
　The second argument is the label at which to start execution. If you specify an empty string, it will be executed from the beginning of the scenario file.<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />kag.process('',&nbsp;'*label2')<br />
kag.process('scenario4.ks',&nbsp;'*label5')<br />
</code>
<br />

<br />
　Note that even if the scenario is running, it will jump to that label.<br />
</div></div>

<h1><a id="id275" name="id275">leftClickHook, rightClickHook, keyDownHook</a>
</h1><div class="para"><div>
　KAG has a function to call the registered function when left-clicking, right-clicking, and when a key is pressed, and is called a hook.<br />
　Hooks are arrayed so that multiple functions can be registered. These are accessible via <code class="inlinecode">kag.leftClickHook</code>, <code class="inlinecode">kag.rightClickHook</code>, and <code class="inlinecode">kag.keyDownHook</code> respectively.<br />
　If any of these functions returns true, KAG will not execute the function originally assigned to that function. For example, if the function registered in keyDownHook returns true when the R key is pressed, the original function &quot;display message history&quot; will not be executed.<br />
<br />
　leftClickHook and rightClickHook have no arguments in the function being called.<br />
　leftClickHook is also generated by the Enter key and the Space key. Also, it does not occur when you click an option with the mouse.<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />@iscript<br />
function&nbsp;myLeftClickHook()<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;kag.process('',&nbsp;'*label');<br />
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;<br />
}<br />
@endscript<br />
@eval&nbsp;exp=&quot;kag.leftClickHook.add(myLeftClickHook)&quot;<br />
@s<br />
<br />
*label<br />
@eval&nbsp;exp=&quot;kag.leftClickHook.remove(myLeftClickHook)&quot;<br />
Hi.<br />
@s<br />
</code>
<br />

<br />
　In the above example, *label is executed when clicked.<br />
　Note that execution is forcibly moved to * label. If a transition or automatic move is in progress, it is safer to stop it with the stoptrans or stopmove tag.<br />
<br />
　keyDownHook when the function being called was passed two arguments, the first is the virtual key code of the pressed key, and the second is the state of the shift key that was pressed at the same time. For more information, see Kirikiri 2 SDK Help.<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />@iscript<br />
function&nbsp;myKeyDownHook(key,&nbsp;shift)<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;if(key&nbsp;==&nbsp;#'R')<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;When&nbsp;the&nbsp;R&nbsp;key&nbsp;is&nbsp;pressed</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kag.process('',&nbsp;'*label');<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
}<br />
@endscript<br />
@eval&nbsp;exp=&quot;kag.keyDownHook.add(myKeyDownHook)&quot;<br />
@s<br />
<br />
*label<br />
@eval&nbsp;exp=&quot;kag.keyDownHook.remove(myKeyDownHook)&quot;<br />
Hi.<br />
@s<br />
</code>
<br />

</div></div>
<h1><a id="id276" name="id276">touchImages</a>
</h1><div class="para"><div>
　<code class="inlinecode">System.touchImages</code> loads images into the cache.<br />
　For more information, see System.touchImages in the Kirikiri 2 document. This method can be used to pre-read an image, for example, when there is some weight and time is available.<br />
　When used in KAG, it is effective for foreground and background images (however, those without specifying the key attribute). Specify the same thing as the one specified in the storage attribute of the image or img tag as an array in the storages argument.<br />
　It seems good to specify around -2 * 1024 * 1024 for the second argument.<br />
　It seems good to specify the waiting time-around 200ms in the third argument.<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />@resetwait<br />
@eval&nbsp;exp=&quot;System.touchImages(['24_5',&nbsp;'24_4',&nbsp;'uni',&nbsp;'24'],&nbsp;-2*1024*1024,&nbsp;800)&quot;<br />
@wait&nbsp;mode=until&nbsp;time=1000<br />
</code>
<br />

<br />
　However, this method is indeterminate, as it does not guarantee that the image will be cached. Therefore, it should never be used for applications where the image must be read first. For such purposes, it is better to use the method described in the section on assignImages below.<br />
</div></div>
<h1><a id="id277" name="id277">assignImages</a>
</h1><div class="para"><div>
　<code class="inlinecode">assignImages</code> copies the image of a layer to another layer.<br />
　For example,<br />
<br />
<code class="inlinecode">@eval exp=&quot;kag.fore.base.assignImages(kag.fore.layers[0])&quot;</code><br />
<br />
　Allows you to copy the image loaded on the foreground layer 0 to the foreground layer.<br />
　assignImages is fast because they don't actually copy the data in the image and mark it as &quot;the image from which it was copied is the same.&quot; In a demo scene, when the time loss when importing an image in the middle of a scene becomes a problem, it can be used for the purpose of loading the image into a hidden foreground layer in advance and then copying it to a background layer when needed.<br />
</div></div>

<h1><a id="id278" name="id278">Application of hact tag</a>
</h1><div class="para"><div>
　The hact tag allows you to execute any TJS expression when you click on the message history, and the audio history (so that you can play the audio corresponding to the message when you click the message history, such as in a voiced game) can be implemented.<br />
　The following is an example to achieve this, and defines a macro pv for playing audio and a macro sv for stopping audio.<br />

<br />
<code class="bq"><span class="weak">例:</span><br />@iscript<br />
function&nbsp;stopAllVoices()<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;Stop&nbsp;all&nbsp;sound&nbsp;effects&nbsp;2&nbsp;to&nbsp;6</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;for(var&nbsp;i&nbsp;=&nbsp;2;&nbsp;i&nbsp;&lt;=&nbsp;6;&nbsp;i++)&nbsp;kag.se[i].stop();<br />
}<br />
function&nbsp;playVoice(buf,&nbsp;storage)<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;Do&nbsp;not&nbsp;process&nbsp;if&nbsp;the&nbsp;KAG&nbsp;playing&nbsp;the&nbsp;storage&nbsp;with&nbsp;the&nbsp;sound&nbsp;effect&nbsp;buffer&nbsp;buf&nbsp;is&nbsp;skipping</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;if(!kag.skipMode)<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stopAllVoices();<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kag.se[buf].play(%[&nbsp;storage&nbsp;:&nbsp;storage&nbsp;]);<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
}<br />
function&nbsp;createHistoryActionExp(buf,&nbsp;storage)<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;Generate&nbsp;a&nbsp;TJS&nbsp;expression&nbsp;to&nbsp;execute&nbsp;when&nbsp;clicking&nbsp;on&nbsp;the&nbsp;message&nbsp;history</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&quot;stopAllVoices(),&nbsp;kag.se[&quot;&nbsp;+&nbsp;buf&nbsp;&nbsp;+&quot;].play(%[&nbsp;storage&nbsp;:&nbsp;'&quot;&nbsp;+&nbsp;storage&nbsp;+&nbsp;&quot;'&nbsp;])&quot;;<br />
}<br />
@endscript<br />
@macro&nbsp;name=pv<br />
@hact&nbsp;exp=&quot;&amp;createHistoryActionExp(mp.b,&nbsp;mp.s)&quot;<br />
@eval&nbsp;exp=&quot;playVoice(mp.b,&nbsp;mp.s)&quot;<br />
@endmacro<br />
@macro&nbsp;name=waitvoices<br />
@ws&nbsp;buf=2<br />
@ws&nbsp;buf=3<br />
@ws&nbsp;buf=4<br />
@ws&nbsp;buf=5<br />
@ws&nbsp;buf=6<br />
@endmacro<br />
@macro&nbsp;name=sv<br />
@endhact<br />
@waitvoices&nbsp;cond=&quot;kag.autoMode&quot;<br />
@eval&nbsp;exp=&quot;stopAllVoices()&quot;<br />
@endmacro<br />
</code>
<br />

<br />
　The createHistoryActionExp function generates a TJS expression to pass to the hact tag's exp attribute. The TJS expression generated here will be executed.<br />
<br />
　An example using this macro looks like this:<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />[pv&nbsp;b=2&nbsp;s=hoge.ogg]Hoge[l][sv][r]<br />
[pv&nbsp;b=3&nbsp;s=hogera.ogg]Hogera[l][sv][r]<br />
[pv&nbsp;b=4&nbsp;s=hogemoge.ogg]Hogemoge[p][sv]<br />
</code>
<br />

</div></div>


<h1><a id="id279" name="id279">Script executed at initialization</a>
</h1><div class="para"><div>
　KAG has the ability to execute arbitrary TJS scripts at several stages of initialization to customize the system. In the current version, the following methods are available.<br />
<br />
<dl>
<dt><a id="id280" name="id280" class="targanchor"><dfn>Override.tjs</dfn></a></dt>
<dd>　This file is executed after MainWindow.tjs is loaded, if it exists. This file does not exist in the initial state, so create a new one.</dd>
<dt><a id="id281" name="id281" class="targanchor"><dfn>AfterInit.tjs</dfn></a></dt>
<dd>　All initialization is done, just before first.ks is executed. This file does not exist in the initial state, so create a new one.</dd>
<dt>&quot;<a id="id282" name="id282" class="targanchor"><dfn>Additional settings</dfn></a>&quot;</dt>
<dd>　There are some places in Config.tjs where you can describe &quot;additional settings&quot; such as &quot;◆ additional settings for windows and behaviors&quot;. The contents described there are executed at each stage of Config.tjs execution.</dd></dl></div></div>
<h1><a id="id283" name="id283">Menu customization</a>
</h1><div class="para"><div>
　To add a simple on / off setting item to a menu item, write the following in AfterInit.tjs.<br />
<br />

<br />
<code class="bq"><span class="weak">例:</span><br />kag.menu.insert(kag.optionsMenu&nbsp;=<br />
&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;KAGMenuItem(this,&nbsp;&quot;Effects(&amp;G)&quot;,&nbsp;0,&nbsp;void,&nbsp;false),&nbsp;2);<br />
kag.optionsMenu.stopRecur&nbsp;=&nbsp;true;<br />
<br />
kag.optionsMenu.add(<br />
&nbsp;&nbsp;&nbsp;&nbsp;kag.doTransMenuItem&nbsp;=&nbsp;new&nbsp;KAGMenuItem(<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Switch&nbsp;screens(&amp;T)&quot;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function(sender)&nbsp;{&nbsp;sf.dotrans&nbsp;=&nbsp;sender.checked&nbsp;=&nbsp;!sf.dotrans;&nbsp;},<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;false));<br />
<br />
if(sf.dotrans&nbsp;===&nbsp;void)&nbsp;sf.dotrans&nbsp;=&nbsp;true;<br />
kag.doTransMenuItem.checked&nbsp;=&nbsp;sf.dotrans;<br />
<br />
kag.optionsMenu.add(<br />
&nbsp;&nbsp;&nbsp;&nbsp;kag.playSEItem&nbsp;=&nbsp;new&nbsp;KAGMenuItem(<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Play&nbsp;sound&nbsp;effects(&amp;S)&quot;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function(sender)&nbsp;{&nbsp;sf.playse&nbsp;=&nbsp;sender.checked&nbsp;=&nbsp;!sf.playse;&nbsp;},<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;false));<br />
<br />
if(sf.playse&nbsp;===&nbsp;void)&nbsp;sf.playse&nbsp;=&nbsp;true;<br />
kag.playSEItem.checked&nbsp;=&nbsp;sf.playse;<br />
</code>
<br />

<br />
　<code class="inlinecode">kag.menu.insert(kag.optionsMenu = new KAGMenuItem(this, &quot;Effects(&amp;G)&quot;, 0, void, false), 2);</code> inserts an &quot;Effects&quot; menu into the KAG menu bar. kag.optionMenu is the object of the &quot;Effects&quot; menu. The second argument of the insert method is the position to insert the menu item.<br />
　The next line sets stopRecur to true for that object so that kag.internalSetMenuAccessibleAll does not search for unnecessary menu items.<br />
<br />
　In the kag.optionsMenu, the child menu item is created by the add method.<br />
<br />
　The fourth argument of KAGMenuItem specifies an expression to execute when the menu item is clicked.<br />
<br />
　In <code class="inlinecode">if(sf.dotrans === void) sf.dotrans = true;</code>, when sf.dotrans is void (that is, there is no value), the initial value is entered. <code class="inlinecode">kag.doTransMenuItem.checked = sf.dotrans;</code> sets the initial state of menu item check. Since the settings are recorded in system variables, the settings will be retained the next time the program ends.<br />
<br />
　After that, the current menu status is recorded in sf.dotrans and sf.playse,<br />
<br />
<code class="inlinecode">@playse storage=&quot;kon.wav&quot; cond=&quot;sf.playse&quot;</code><br />
　It can be used as such.<br />
<br />
　I think you can do various things by applying.<br />
</div></div>

<h1><a id="id284" name="id284">Write a plugin for KAG</a>
</h1><div class="para"><div>
　By creating a subclass of <a id="id285" name="id285" class="targanchor"><dfn>KAGPlugin class</dfn></a> and registering with KAG, you can create a plugin that extends the functionality of KAG.<br />
　I think the samples are distributed with the KAG distribution files, so check them out.<br />
</div></div>
	<script type="text/javascript" charset="UTF-8" src="documentid.js" ></script>
	<script type="text/javascript" charset="UTF-8" src="postcontent.js" ></script>
</body>
</html>
