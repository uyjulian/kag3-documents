<?xml version="1.0" encoding="UTF-8" ?>
<doc>
<title>KAG 3 未満からの移植と KAG 3 での新機能</title>
<para>
<ptitle>KAG 3 未満からの移植について</ptitle>
　KAG 3 はそれまでの KAG を新しく書き直したもので、シナリオレベルでの互換性はありますが、細かい差異もあります。<r/>
　もっとも大き変更は、シナリオファイル中の改行を無視するようになったことですが、これは Config.tjs の <tt>global.ignoreCR</tt> を <tt>false</tt> に指定することで旧 KAG の動作と同じにすることができます。<r/>
　また、quake タグの time 属性は、KAG 3 では ms 単位になりました。KAG 3 未満の、文字数単位にしたい場合は Config.tjs の <tt>defaultQuakeTimeInChUnit</tt> を <tt>true</tt> に設定してください。<r/>
<r/>
　KAG 3 未満に比べて、文字が大きめに出てきます。小さめのフォントを指定してみてください。<r/>
<r/>
　セーブデータの保存場所は、デフォルトで実行可能ファイルのあるフォルダ以下の savedata フォルダになっていますのでご注意ください。<r/>
<r/>
　タグもいくつかの相違点があります。<r/>
<ul>
  <li>emb タグに zenkaku 属性がない</li>
  <li>playvideo の usesound 属性廃止</li>
  <li>clearsysvar はシステム変数をクリアするだけ</li>
</ul>
<r/>
　他にも動作が違うタグがあるかもしれませんが、おそらく KAG 3 のバグかと思います。変に思ったら作者までご一報ください。
<r/>
　プラグインの扱いの違いについては <link href="Prepare"/> の「プラグインについて」をご覧ください。<r/>
</para>

<para>
<ptitle>KAG 3 の新機能</ptitle>
<dl>
<dt>KAG のシナリオ解析部を吉里吉里２本体に内蔵</dt>
<dd>
　吉里吉里２本体には KAG のシナリオを解析するための機能が組み込まれまし
た。KAG 2.x では TJS スクリプトで処理していましたが、これを本体に内蔵す
ることによってシナリオの解析速度が飛躍的に高速化されました。
</dd>

<dt>ほとんどのタグに cond 属性が使える</dt>

<dd>
　cond 属性はほとんどすべてのタグに使用でき、cond="式" で指定した式が真
の場合だけ、そのタグを実行するようになります。たとえば、<r/>
<bq>
[jump cond="f.flag1==0" target=*loop]<r/>
</bq>
と記述すると、f.flag1 が 0 の時だけ *loop というラベルにジャンプする、と
いう意味になります。
</dd>

<dt>アニメーション情報ファイルが asq から asd になった</dt>
<dd>
　より汎用性の高い形式である asd 形式になりました。配布ファイル中の
asq2asd は asq ファイルを asd ファイルに変換するスクリプトです。asd ファ
イルの記述については AnimationLayer.tjs 内をご覧ください。<r/>
　また、アニメーションセグメントと呼ばれる方法を使って、一つの画像に対し
て複数のアニメーションを同時に実行できます。
</dd>

<dt>メッセージ履歴が縦書き表示できるようになった</dt>

<dd>
　横書きに加えて縦書き表示ができるようになりました。Config.tjs で設定し
ます。
</dd>

<dt>セーブデータの暗号化が可能に</dt>

<dd>
　セーブデータに簡単な暗号化をかけることができるようになりました。
Config.tjs で設定します。
</dd>

<dt>UNICODE ファイルへの対応</dt>

<dd>
　吉里吉里２が出力するテキストファイルは基本的に UNICODE ( UTF-16 ) です。<r/>
　セーブデータなどは UNICODE で出力されます。UNICODE を扱うことのできる
テキストエディタを用意しておくと便利かと思います。<r/>
　また、吉里吉里２へ読み込ませるファイル ( KAG シナリオなど ) として UNICODE 形式の
テキストファイルを読み込ませることが可能になりました。
</dd>

<dt>ムービー形式として MPEG に正式対応</dt>

<dd>
　MPEG を再生できるようになりました。アーカイブ内に MPEG ファイルを納め
ても再生できます。<r/>
　ただし、ムービーを再生するには、吉里吉里２本体に付属している
krmovie.dll を、吉里吉里２本体と同じフォルダにおいておく必要があります。<r/>
　また、ムービーを再生するために DirectX8 以降が OS にインストールされて
いる必要があります(DirectX9以降を推奨します)。
</dd>

<dt>レンダリング済みフォントへの対応</dt>

<dd>
　レンダリング済みフォントを使用することによって、OS や環境によるフォント
の違いや、字詰めの問題を回避できます。また、作成者側の環境でのフォントデ
ータを用いるため、プレーヤの環境にないフォントや外字を使用することができ
ます。<r/>
　レンダリング済みフォントを作成するには krkrfont.exe を使います。
</dd>
</dl>
</para>
</doc>
